(function(){var a="sproutcore/standard_theme";if(!SC.BUNDLE_INFO){throw"SC.BUNDLE_INFO is not defined!"
}if(SC.BUNDLE_INFO[a]){return}SC.BUNDLE_INFO[a]={requires:["sproutcore/empty_theme"],styles:["/static/sproutcore/standard_theme/en/current/stylesheet-packed.css","/static/sproutcore/standard_theme/en/current/stylesheet.css"],scripts:["/static/sproutcore/standard_theme/en/current/javascript-packed.js"]}
})();DeviceHub=SC.Application.create({NAMESPACE:"DeviceHub",VERSION:"0.1.0",store:SC.Store.create({commitRecordsAutomatically:YES}).from("DeviceHub.RailsDataSource")});
DeviceHub.deviceController=SC.ObjectController.create(SC.CollectionViewDelegate,{contentBinding:"DeviceHub.devicesController.selection",cancel:function(){DeviceHub.devicePage.getPath("mainPane").remove()
}});DeviceHub.devicesController=SC.ArrayController.create(SC.CollectionViewDelegate,{selectionDidChange:function(){}.observes("selection"),loadDevices:function(){var a=DeviceHub.store.find(DeviceHub.DEVICES_QUERY);
var b=DeviceHub.store.find(DeviceHub.PACKETS_QUERY);DeviceHub.devicesController.set("content",a);
DeviceHub.devicesController.set("packets",b)},refreshDevices:function(){DeviceHub.store.reset();
this.get("content").refresh();this.get("packets").refresh()},addDevice:function(){DeviceHub.devicePage.getPath("mainPane").append()
},deleteDevice:function(){SC.AlertPane.warn("Opravdu si přejete odstranit zařízení?","Odstraněním zařízení budou nenávratně ztracena i všechna jeho data.","","Odstranit","Zrušit",DeviceHub.devicesController)
},collectionViewDeleteContent:function(b,e,d){var c=d.map(function(f){return this.objectAt(f)
},this);c.invoke("destroy");var a=d.get("min")-1;if(a<0){a=0}this.selectObject(this.objectAt(a))
},alertPaneDidDismiss:function(c,a){if(a==SC.BUTTON1_STATUS){var b=DeviceHub.mainPage.getPath("mainPane.splitView.topLeftView.contentView");
b.set("canDeleteContent",YES);b.deleteSelection();b.set("canDeleteContent",NO)}},});
DeviceHub.packetsController=SC.ArrayController.create({contentBinding:"DeviceHub.deviceController.packets"});
DeviceHub.Device=SC.Record.extend({primaryKey:"id",name:SC.Record.attr(String),ipAddress:SC.Record.attr(String,{key:"ip_address"}),currentState:SC.Record.attr(String,{key:"current_state"}),currentStateName:SC.Record.attr(String,{key:"current_state_name"}),packets:SC.Record.toMany("DeviceHub.Packet",{inverse:"device",isMaster:YES}),icon:"/static/device_hub/en/current/resources/icons/server.png",stateIcon:function(){this.get("currentState");
return"/static/device_hub/en/current/resources/icons/server.png"}.property()});sc_require("models/device");
DeviceHub.DEVICES_QUERY=SC.Query.local(DeviceHub.Device,{});DeviceHub.PACKETS_QUERY=SC.Query.local(DeviceHub.Packet,{});
DeviceHub.RailsDataSource=SC.DataSource.extend({fetch:function(a,b){switch(b){case DeviceHub.DEVICES_QUERY:SC.Request.getUrl("/devices.json").json().notify(this,"didFetchDevices",a,b).send();
return YES;case DeviceHub.PACKETS_QUERY:SC.Request.getUrl("/packets.json").json().notify(this,"didFetchPackets",a,b).send();
return YES}return NO},didFetchDevices:function(b,a,c){if(SC.ok(b)){a.loadRecords(DeviceHub.Device,b.get("body"));
a.dataSourceDidFetchQuery(c)}else{a.dataSourceDidErrorQuery(c,b)}},didFetchPackets:function(b,a,c){if(SC.ok(b)){a.loadRecords(DeviceHub.Packet,b.get("body"));
a.dataSourceDidFetchQuery(c)}else{a.dataSourceDidErrorQuery(c,b)}},retrieveRecord:function(a,b){alert("retrieveRecord");
return NO},createRecord:function(a,b){return NO},updateRecord:function(a,b){return NO
},destroyRecord:function(a,c){var d=a.idFor(c);if(SC.kindOf(a.recordTypeFor(c),DeviceHub.Device)){var b="/devices/"+d+".json";
SC.Request.deleteUrl(b).json().notify(this,this.didDestroyRecord,a,c).send();return YES
}return NO},didDestroyRecord:function(b,a,c){if(SC.ok(b)){a.dataSourceDidDestroy(c)
}else{a.dataSourceDidError(b)}}});DeviceHub.ErrorMessage=SC.Record.extend({});DeviceHub.Packet=SC.Record.extend({primaryKey:"id",createdAt:SC.Record.attr(SC.DateTime,{key:"created_at"}),address:SC.Record.attr(String,{key:"address"}),data:SC.Record.attr(String,{key:"data"}),device:SC.Record.toOne("DeviceHub.Device",{inverse:"packets",isMaster:NO}),time:function(){return this.get("createdAt").toFormattedString("%H:%M:%S")
}.property().cacheable()});DeviceHub.devicePage=SC.Page.design({mainPane:SC.PanelPane.design({layout:{centerX:0,width:400,centerY:0,height:200},contentView:SC.View.design({childViews:"title prompt createButton cancelButton nameLabel nameTextField ipAddressLabel ipAddressTextField".w(),title:SC.LabelView.design({layout:{top:12,left:20,height:24,right:20},controlSize:SC.LARGE_CONTROL_SIZE,fontWeight:SC.BOLD_WEIGHT,value:"Přidat zařízení"}),prompt:SC.LabelView.design({layout:{top:36,left:20,height:18,right:20},value:"Zadejte údaje o novém zařízení:"}),nameLabel:SC.LabelView.design({layout:{top:70,left:50,width:70,height:18},textAlign:SC.ALIGN_RIGHT,value:"Název"}),nameTextField:SC.TextFieldView.design({layout:{top:70,left:130,height:20,width:200},hint:"Zařízení",valueBinding:"DeviceHub.deviceController.name"}),ipAddressLabel:SC.LabelView.design({layout:{top:100,left:50,width:70,height:18},textAlign:SC.ALIGN_RIGHT,value:"IP Adresa"}),ipAddressTextField:SC.TextFieldView.design({layout:{top:100,left:130,height:20,width:200},hint:"192.168.1.1",valueBinding:"DeviceHub.deviceController.ipAddress"}),createButton:SC.ButtonView.design({layout:{bottom:20,right:20,width:90,height:24},title:"Vytvořit",isDefault:YES,action:"submit"}),cancelButton:SC.ButtonView.design({layout:{bottom:20,right:120,width:90,height:24},title:"Zrušit",isCancel:YES,target:"DeviceHub.deviceController",action:"cancel"})})})});
DeviceHub.mainPage=SC.Page.design({mainPane:SC.MainPane.design({childViews:"toolbarView splitView".w(),toolbarView:SC.ToolbarView.design({layout:{top:0,left:0,right:0,height:36},childViews:"labelView refreshButton addButton removeButton".w(),anchorLocation:SC.ANCHOR_TOP,labelView:SC.LabelView.design({layout:{centerY:0,height:24,right:10,width:150},textAlign:"right",controlSize:SC.LARGE_CONTROL_SIZE,fontWeight:SC.BOLD_WEIGHT,value:"Device Hub"}),refreshButton:SC.ButtonView.design({layout:{centerY:0,height:24,left:10,width:100},icon:"/static/device_hub/en/current/resources/icons/arrow-circle-double.png",title:"Obnovit",target:"DeviceHub.devicesController",action:"refreshDevices"}),addButton:SC.ButtonView.design({layout:{centerY:0,height:24,left:115,width:100},icon:"/static/device_hub/en/current/resources/icons/plus-circle.png",title:"Přidat",target:"DeviceHub.devicesController",action:"addDevice"}),removeButton:SC.ButtonView.design({layout:{centerY:0,height:24,left:220,width:100},icon:"/static/device_hub/en/current/resources/icons/minus-circle.png",title:"Odstranit",target:"DeviceHub.devicesController",action:"deleteDevice"})}),splitView:SC.SplitView.design({layout:{top:36,right:0,bottom:0,left:0},defaultThickness:0.25,topLeftView:SC.ScrollView.design({hasHorizontalScroller:NO,backgroundColor:"white",anchorLocation:SC.ANCHOR_BOTTOM,contentView:SC.SourceListView.design({contentBinding:"DeviceHub.devicesController.arrangedObjects",selectionBinding:"DeviceHub.devicesController.selection",contentValueKey:"name",hasContentIcon:YES,contentIconKey:"icon",rowHeight:25,destroyOnRemoval:YES})}),bottomRightView:SC.View.design({backgroundColor:"#d4d7e0",childViews:"wellView tabView".w(),wellView:SC.WellView.design({layout:{top:15,left:15,right:15,height:80},contentView:SC.View.design({childViews:"deviceCurrentStateNameLabelView deviceCurrentStateNameValueLabelView deviceIpAddressLabelView deviceIpAddressValueLabelView".w(),deviceCurrentStateNameLabelView:SC.LabelView.design({layout:{top:0,height:20,width:100,left:20},value:"Stav zařízení"}),deviceCurrentStateNameValueLabelView:SC.LabelView.design({layout:{top:0,height:20,width:200,left:150},valueBinding:"DeviceHub.deviceController.currentStateName"}),deviceIpAddressLabelView:SC.LabelView.design({layout:{top:30,height:20,width:100,left:20},value:"IP Adresa"}),deviceIpAddressValueLabelView:SC.LabelView.design({layout:{top:30,height:20,width:200,left:150},valueBinding:"DeviceHub.deviceController.ipAddress"})})}),tabView:SC.TabView.design({layout:{left:15,right:15,top:110,bottom:15},nowShowing:"DeviceHub.mainPage.packetsTableView",itemTitleKey:"title",itemValueKey:"value",items:[{title:"Pakety",value:"DeviceHub.mainPage.packetsTableView"},{title:"Chybová hlášení",value:""}]})})})}),packetsTableView:SC.TableView.design({layout:{left:15,right:15,top:15,bottom:15},backgroundColor:"white",columns:[SC.TableColumn.create({key:"time",label:"Čas",width:100}),SC.TableColumn.create({key:"address",label:"Adresa",width:100}),SC.TableColumn.create({key:"data",label:"Data",width:200})],contentBinding:"DeviceHub.packetsController.arrangedObjects",selectionBinding:"DeviceHub.packetsController.selection",selectOnMouseDown:YES,exampleView:SC.TableRowView,recordType:DeviceHub.Packet})});
DeviceHub.main=function main(){DeviceHub.getPath("mainPage.mainPane").append()};function main(){DeviceHub.main();
DeviceHub.devicesController.loadDevices()};